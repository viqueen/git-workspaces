# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

### Development

- `npm install` - Install dependencies
- `npm run build` - Compile TypeScript to JavaScript (outputs to dist/)
- `npm run build:watch` - Compile TypeScript in watch mode
- `npm test` - Run all tests with Jest and generate coverage
- `npm run test:watch` - Run tests in watch mode
- `npm run format` - Format code with Prettier
- `npm run format:check` - Check code formatting
- `npm run lint` - Run ESLint on src/ directory

### Testing

- Tests are written using Jest with ts-jest preset
- Test files follow the pattern `*.test.ts`
- Coverage reports are generated in the `coverage/` directory
- Run specific test: `npm test -- path/to/file.test.ts`

## Architecture

### Project Structure

This is a TypeScript CLI tool that provides Git workspace management utilities. The codebase is organized as follows:

- **src/bin/** - CLI entry points for all git commands (git-recent, git-merged, git-workspace, etc.)
- **src/lib/** - Core library functions and utilities shared across commands
- **src/streams/** - Stream implementations for GitHub and Bitbucket Cloud APIs
- **src/tasks/** - Task implementations for workspace operations (clone, sync, exec)
- **dist/** - Compiled JavaScript output (generated by TypeScript compiler)

### Key Components

**Workspace Management**: The system uses git global config to store workspace configuration:

- `git.workspaces.root` - Root directory for all workspaces
- `git.workspaces.default` - Default workspace name
- Items are stored using @labset/leveldb-registry for persistence

**Item Model**: Core data structure representing a repository:

- `urlConnection` - Repository URL
- `workspace` - Workspace name
- `host`, `namespace`, `slug` - Parsed repository components

**External Dependencies**:

- `simple-git` - Git operations
- `inquirer` - Interactive CLI prompts
- `commander` - Command-line interface parsing
- `axios` - HTTP requests for API interactions
- `@labset/leveldb-registry` - Local database for workspace items
- `@labset/task-pool-executor` - Concurrent task execution

### Code Conventions

- TypeScript with strict mode enabled (`strictNullChecks`, `noImplicitAny`)
- CommonJS module system
- Apache-2.0 license headers required on all source files
- ESLint with custom rules including license notice validation
- Prettier formatting with 4-space tabs for TypeScript files
- Test files colocated with source files using `.test.ts` suffix
